# Trade Diary Mini App (Bybit + OKX)

Простое приложение-дневник сделок:
- хранит вход/выход по споту
- считает прибыль/убыток в USDT и %
- считает длительность сделки
- показывает средний профит/лосс
- умеет подключать API-профили Bybit и OKX
- умеет подтягивать спотовые исполнения с Bybit и OKX
- может работать как Telegram Mini App

## 1) Что установить

1. Установи **Node.js LTS** (18+).
2. Открой проект в **Visual Studio Code**.
3. Открой терминал в VS Code: `Terminal -> New Terminal`.

## 2) Как запустить локально

В терминале выполни:

```bash
cd app
npm install
cp .env.example .env
npm run dev
```

После запуска открой:

- [http://localhost:8000](http://localhost:8000)

## 3) Как подключить API

В форме логина выбери биржу:

- `Bybit`: укажи `API Key` и `API Secret`
- `OKX`: укажи `API Key`, `API Secret` и `API Passphrase`

Открой файл `.env` и (опционально) заполни Bybit-переменные:

```env
BYBIT_API_KEY=твой_ключ
BYBIT_API_SECRET=твой_секрет
```

Рекомендация по безопасности:
- Создай API ключ только с правами чтения (Read-Only), без вывода средств.

## 4) Как работает синхронизация

Автосинхронизация сделок работает для профилей Bybit и OKX.
Лимит по дням снят: приложение запрашивает максимально доступную историю сделок с биржи.

Кнопка "Синхронизировать" делает:
- `BUY` -> создает открытую сделку
- `SELL` -> закрывает открытые сделки по FIFO

Если `SELL` больше, чем открытые позиции, излишек попадет в `unmatched_sell_qty` в ответе API.

## 5) Telegram Mini App (реально сделать)

Да, это можно сделать.

Нужно 3 шага:

1. Сделать публичный HTTPS URL для твоего локального сервера (например через ngrok).
2. В BotFather создать бота и привязать Mini App URL.
3. Открывать Mini App через кнопку бота.

Пример с ngrok:

```bash
# в отдельном терминале
ngrok http 8000
```

ngrok даст URL вида `https://xxxx.ngrok-free.app`.

Этот URL ставишь в BotFather как Web App URL.

## 6) Основные API

- `GET /api/trades` - список сделок
- `POST /api/trades` - добавить сделку вручную
- `PUT /api/trades/:id/close` - закрыть открытую сделку
- `GET /api/stats` - статистика
- `POST /api/bybit/sync` - синхронизировать сделки с Bybit

## 7) Важно

Это MVP (первая версия), чтобы быстро стартовать.
Для продакшена нужно добавить:
- авторизацию пользователей
- хранение ключей в шифровании
- валидацию API-подписей Telegram
- деплой на сервер (Railway/Render/VPS)

## 8) Деплой на VPS

Пошаговая инструкция лежит в файле:

- `DEPLOY_VPS.md`

## 9) Деплой в Railway (проще)

Если ты не хочешь возиться с сервером, используй Railway:

- `DEPLOY_RAILWAY.md`
